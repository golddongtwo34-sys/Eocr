<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>모터 EOCR 계산기 (LS 기준)</title>
<style>
  :root{
    --bg:#0b0f14; --card:#121826; --text:#e6edf3; --muted:#9fb0c0; --line:#223048; --accent:#3aa0ff;
    --r:20px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",system-ui,Segoe UI,Roboto,sans-serif;}
  header{position:sticky;top:0;z-index:5;padding:20px 16px 14px;
    background:linear-gradient(to bottom, rgba(11,15,20,.98), rgba(11,15,20,.70));
    backdrop-filter: blur(10px);
    border-bottom:1px solid rgba(34,48,72,.45);
  }
  h1{margin:0;font-size:24px;letter-spacing:-.2px}
  .sub{margin-top:7px;color:var(--muted);font-size:15px;line-height:1.4}
  main{padding:14px 16px 28px;max-width:820px;margin:0 auto;display:flex;flex-direction:column;gap:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:18px}
  .grid{display:grid;gap:12px}
  .grid2{grid-template-columns:1fr 1fr}
  label.tag{display:block;color:var(--muted);font-size:15px;margin:0 0 8px}
  select,input,button{
    width:100%;
    background:#0e1422;color:var(--text);border:1px solid var(--line);border-radius:16px;
    padding:16px 14px;font-size:20px;outline:none;
  }
  button{
    font-weight:800;
    background:linear-gradient(180deg, rgba(58,160,255,.26), rgba(58,160,255,.10));
    border:1px solid rgba(58,160,255,.42);
  }
  button:active{transform:scale(.99)}
  .pillrow{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-flex;align-items:center;gap:10px;padding:12px 12px;border-radius:999px;
    border:1px solid var(--line);background:#0e1422}
  .pill input{width:auto;transform:scale(1.45);margin:0}
  .pill span{font-size:17px}
  .hint{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.5}
  .kv{display:flex;justify-content:space-between;gap:14px;padding:16px 14px;border:1px dashed var(--line);border-radius:16px}
  .kv .k{color:var(--muted);font-size:15px}
  .kv .v{font-variant-numeric:tabular-nums;font-size:20px;font-weight:900;text-align:right}
  details{border:1px solid var(--line);border-radius:var(--r);background:#0e1422}
  summary{padding:16px 16px;cursor:pointer;font-size:17px}
  details .inner{padding:0 16px 16px}
  table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:16px;border:1px solid var(--line)}
  th,td{padding:12px 10px;font-size:14px;border-bottom:1px solid rgba(34,48,72,.55)}
  th{color:var(--muted);text-align:left;background:#0b1222;font-weight:700}
  tr:last-child td{border-bottom:none}
  .footer{max-width:820px;margin:0 auto;padding:8px 16px 26px;color:var(--muted);font-size:12px;line-height:1.5}
  .warn{color:#ffcc66}
  .mono{font-variant-numeric:tabular-nums}
</style>
</head>
<body>
<header>
  <h1>모터 EOCR 계산기 (LS 기준)</h1>
  <div class="sub">결과: <b>정격전류 / LS EOCR 기종명 / EOCR 세팅값 / 전선(㎟)</b> (전압강하는 옵션 ON일 때만 표기)</div>
</header>

<main>
  <section class="card">
    <div class="grid grid2">
      <div>
        <label class="tag">전원</label>
        <select id="phase">
          <option value="three">삼상(3Φ)</option>
          <option value="single">단상(1Φ)</option>
        </select>
      </div>
      <div>
        <label class="tag">입력 단위</label>
        <select id="unit">
          <option value="hp">HP</option>
          <option value="kw">kW</option>
        </select>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label class="tag">값 입력</label>
      <input id="value" inputmode="decimal" placeholder="예: 10" />
      <div class="hint">예) 10HP, 7.5kW</div>
    </div>

    <div class="pillrow" style="margin-top:14px;">
      <label class="pill"><input type="checkbox" id="optVolt"><span>전압 선택(고급)</span></label>
      <label class="pill"><input type="checkbox" id="optNameplate" checked><span>명판전류(고급)</span></label>
      <label class="pill"><input type="checkbox" id="optDrop"><span>전압강하(옵션)</span></label>
    </div>
  </section>

  <details id="advPanel">
    <summary>고급 옵션</summary>
    <div class="inner">
      <div id="voltBox" style="display:none; margin-bottom:14px;">
        <div class="grid grid2">
          <div id="singleVoltWrap" style="display:none;">
            <label class="tag">단상 전압</label>
            <select id="vSingle">
              <option value="220">220V</option>
              <option value="110">110V</option>
            </select>
          </div>
          <div id="threeVoltWrap">
            <label class="tag">삼상 전압</label>
            <select id="vThree">
              <option value="380">380V</option>
              <option value="400">400V</option>
              <option value="440">440V</option>
            </select>
          </div>
        </div>
        <div class="hint">전압을 모르면 끄고 사용(기본: 단상 220V / 삼상 380V).</div>
      </div>

      <div id="nameplateBox" style="margin-bottom:14px;">
        <div class="grid grid2">
          <div>
            <label class="tag">전류 기준</label>
            <select id="currentMode">
              <option value="calc">계산전류 사용</option>
              <option value="nameplate">명판전류(FLA) 입력</option>
            </select>
          </div>
          <div id="nameplateWrap" style="display:none;">
            <label class="tag">명판전류 FLA (A)</label>
            <input id="fla" inputmode="decimal" placeholder="예: 15.2" />
          </div>
        </div>
        <div class="hint">명판전류가 있으면 추천(전선/EOCR) 정확도가 좋아집니다.</div>
      </div>

      <div style="margin-bottom:14px;">
        <label class="tag">전선 허용전류 기준(간이)</label>
        <select id="cableMethod">
          <option value="b1">B1 전선관(3심 부하도체, 30℃ 근사) — 보수적</option>
          <option value="general" selected>일반 현장 간이(보수적)</option>
        </select>
        <div class="hint warn">※ 현장 포설/온도/집합/다심수에 따라 달라집니다. 최종은 KEC/KS 표 & 보정계수로 확인하세요.</div>
      </div>

      <div id="dropBox" style="display:none;">
        <div class="grid grid2">
          <div>
            <label class="tag">거리(편도) m</label>
            <input id="len" inputmode="decimal" placeholder="예: 30" />
            <div class="hint">전압강하는 “표기만” 합니다(다른 추천값에 반영하지 않음).</div>
          </div>
          <div>
            <label class="tag">허용 전압강하 %</label>
            <input id="dropPct" inputmode="decimal" value="3" />
          </div>
        </div>
      </div>

      <div class="hint">
        <b>EOCR 모델 표기 기준</b> (LS GMP 자료):<br>
        GMP22: <span class="mono">0.3~1.5 / 1~5 / 4.4~22A</span>, GMP40: <span class="mono">4~20 / 8~40A</span>, GMP60(TZ): <span class="mono">0.5~6 / 5~60A</span> 중 정격전류가 들어가는 “가장 작은” 범위를 선택해 표기합니다.
      </div>
    </div>
  </details>

  <details id="quickPanel">
    <summary>빠른 추천표(HP 기준)</summary>
    <div class="inner">
      <div class="hint">현재 선택된 전원/전압 기준으로 주요 HP를 한 번에 보여줍니다. (명판전류가 있으면 명판전류를 우선)</div>
      <div style="margin-top:10px; overflow:auto;">
        <table id="hpTable">
          <thead>
            <tr>
              <th>HP</th>
              <th>kW</th>
              <th>정격전류(A)</th>
              <th>LS EOCR</th>
              <th>전선(㎟)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="hint warn">표는 “근사”입니다. 최종은 명판/규정 확인.</div>
    </div>
  </details>

  <section class="card">
    <button id="calcBtn">계산하기</button>
  </section>

  <section class="card">
    <div class="grid" id="result">
      <div class="sub">값을 입력하고 계산하기를 누르세요.</div>
    </div>
  </section>
</main>

<div class="footer">
  <div>※ 간이 계산기입니다. 최종 선정은 모터 명판/배선조건/규정(KEC/KS)에 따르세요.</div>
</div>

<script>
  const $ = (id) => document.getElementById(id);
  const num = (s) => {
    if (s == null) return null;
    const t = String(s).replace(",", ".").trim();
    if (!t) return null;
    const v = Number(t);
    return Number.isFinite(v) ? v : null;
  };
  const fmt = (x, d=1) => (Number.isFinite(x) ? x.toFixed(d) : "-");

  // Defaults (근사)
  const PF_SINGLE = 0.90, PF_THREE = 0.85;
  const EFF_SINGLE = 0.85, EFF_THREE = 0.90;

  function hpToKw(hp){ return hp * 0.7457; }
  function kwToHp(kw){ return kw / 0.7457; }

  function currentFromKw(phase, kw, v){
    if (phase === "single") return (1000 * kw) / (v * PF_SINGLE * EFF_SINGLE);
    return (1000 * kw) / (1.7320508075688772 * v * PF_THREE * EFF_THREE);
  }

  // ===== EOCR (LS GMP 시리즈) =====
  function roundEocrSetting(a){
    return (Math.round(a*10)/10).toFixed(1).replace(/\.0$/,"");
  }
  function recommendedEocrSettingA(I){ return I * 1.10; }

  // LS GMP 자료 기준 범위(정격전류가 들어가는 가장 작은 범위 선택)
  const LS_EOCR_RANGES = [
    {model:"GMP22-2P",  range:[0.3, 1.5], label:"0.3~1.5A"},
    {model:"GMP22-2P",  range:[1.0, 5.0], label:"1~5A"},
    {model:"GMP22-2P",  range:[4.4, 22.0], label:"4.4~22A"},
    {model:"GMP40-2P",  range:[4.0, 20.0], label:"4~20A"},
    {model:"GMP40-2P",  range:[8.0, 40.0], label:"8~40A"},
    {model:"GMP60-3TZ", range:[0.5, 6.0], label:"0.5~6A"},
    {model:"GMP60-3TZ", range:[5.0, 60.0], label:"5~60A"},
  ];

  function getLsEocrModelName(I){
    if (I <= 0) return "-";
    const setA = roundEocrSetting(recommendedEocrSettingA(I));

    // 후보 중 "I가 범위에 포함"되는 것만
    const candidates = LS_EOCR_RANGES.filter(r => I >= r.range[0] && I <= r.range[1]);
    if (candidates.length === 0){
      if (I < 0.3) return `0.3A 미만: 별도 검토 / 설정 ${setA}A`;
      return `60A 초과: 외부 CT형 EOCR 필요 / 설정 ${setA}A`;
    }

    // 가장 작은 상한(=가장 작은 기종) 선택
    candidates.sort((a,b)=>a.range[1]-b.range[1]);
    const pick = candidates[0];
    return `${pick.model} (${pick.label}) / 설정 ${setA}A`;
  }

  // ===== 전선 허용전류 기반 추천 =====
  const AMPACITY = {
    // 보수적(B1 전선관 근사)
    b1: [
      {sq: 1.5, A: 18},
      {sq: 2.5, A: 21},
      {sq: 4,   A: 28},
      {sq: 6,   A: 36},
      {sq: 10,  A: 50},
      {sq: 16,  A: 68},
      {sq: 25,  A: 89},
      {sq: 35,  A: 110},
      {sq: 50,  A: 134},
      {sq: 70,  A: 171},
      {sq: 95,  A: 207}
    ],
    // 현장 보수적 간이(조금 더 여유)
    general: [
      {sq: 1.5, A: 20},
      {sq: 2.5, A: 27},
      {sq: 4,   A: 36},
      {sq: 6,   A: 47},
      {sq: 10,  A: 65},
      {sq: 16,  A: 85},
      {sq: 25,  A: 110},
      {sq: 35,  A: 135},
      {sq: 50,  A: 165},
      {sq: 70,  A: 210},
      {sq: 95,  A: 255}
    ]
  };

  function recommendedCableSq(I){
    const method = $("cableMethod").value;
    const tbl = AMPACITY[method] || AMPACITY.general;
    const target = I * 1.25; // 모터 회로 여유(간이)
    for (const row of tbl){
      if (row.A >= target) return row.sq;
    }
    return tbl[tbl.length-1].sq;
  }

  function voltageDropNote(phase, I, v, length_m, cable_sq){
    const R_per_km = 17.241 / cable_sq; // copper approx at 20C
    const R = R_per_km * (length_m * 2 / 1000); // round trip
    const dropV = (phase === "single") ? (I * R) : (1.7320508075688772 * I * R);
    const dropPct = (dropV / v) * 100;
    return {dropV, dropPct};
  }

  function getVoltage(){
    const phase = $("phase").value;
    let v = (phase === "single") ? 220 : 380;
    if ($("optVolt").checked){
      v = (phase === "single") ? num($("vSingle").value) : num($("vThree").value);
    }
    return v;
  }

  function syncAdvVisibility(){
    const phase = $("phase").value;
    $("voltBox").style.display = $("optVolt").checked ? "block" : "none";
    $("nameplateBox").style.display = $("optNameplate").checked ? "block" : "none";
    $("dropBox").style.display = $("optDrop").checked ? "block" : "none";
    $("singleVoltWrap").style.display = (phase === "single") ? "block" : "none";
    $("threeVoltWrap").style.display = (phase === "three") ? "block" : "none";
    const showFla = $("optNameplate").checked && $("currentMode").value === "nameplate";
    $("nameplateWrap").style.display = showFla ? "block" : "none";
  }

  function buildHpTable(){
    const phase = $("phase").value;
    const v = getVoltage();
    const method = $("cableMethod").value;

    const tbody = $("hpTable").querySelector("tbody");
    tbody.innerHTML = "";

    const hpList = [0.5,1,2,3,5,7.5,10,15,20,25,30,40,50,60,75,100];

    for (const hp of hpList){
      const kw = hpToKw(hp);
      const I = currentFromKw(phase, kw, v);
      const eocr = getLsEocrModelName(I);
      const cable = recommendedCableSq(I);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="mono">${hp}</td>
        <td class="mono">${fmt(kw,2)}</td>
        <td class="mono">${fmt(I,1)}</td>
        <td>${eocr}</td>
        <td class="mono">${fmt(cable,1)}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  ["phase","optVolt","vSingle","vThree","cableMethod"].forEach(id=>{
    $(id).addEventListener("change", ()=>{ syncAdvVisibility(); buildHpTable(); });
  });

  // nameplate mode toggle
  $("optNameplate").addEventListener("change", syncAdvVisibility);
  $("currentMode").addEventListener("change", syncAdvVisibility);

  syncAdvVisibility();
  buildHpTable();

  function compute(){
    const phase = $("phase").value;
    const unit = $("unit").value;
    const input = num($("value").value);
    if (!input || input <= 0) return {ok:false, msg:"HP 또는 kW 값을 입력하세요."};

    const v = getVoltage();
    const kw = (unit === "kw") ? input : hpToKw(input);
    const calcI = currentFromKw(phase, kw, v);
    let ratedI = calcI;

    if ($("optNameplate").checked && $("currentMode").value === "nameplate"){
      const fla = num($("fla").value);
      if (fla && fla > 0) ratedI = fla;
      else return {ok:false, msg:"명판전류 모드: FLA(A)를 입력하세요."};
    }

    const eocrSet = recommendedEocrSettingA(ratedI);
    const eocrModel = getLsEocrModelName(ratedI);
    const cable = recommendedCableSq(ratedI);

    let drop = null;
    if ($("optDrop").checked){
      const len = num($("len").value);
      const allowPct = num($("dropPct").value) ?? 3;
      if (len && len > 0){
        const d = voltageDropNote(phase, ratedI, v, len, cable);
        drop = {...d, allowPct};
      } else {
        drop = {dropV: NaN, dropPct: NaN, allowPct};
      }
    }

    return {ok:true, ratedI, eocrModel, eocrSet, cable, drop};
  }

  function render(res){
    const box = $("result");
    box.innerHTML = "";
    if (!res.ok){
      const div = document.createElement("div");
      div.className = "sub";
      div.textContent = res.msg;
      box.appendChild(div);
      return;
    }

    const kv = (label, value) => {
      const d = document.createElement("div");
      d.className = "kv";
      d.innerHTML = `<span class="k">${label}</span><span class="v">${value}</span>`;
      return d;
    };

    box.appendChild(kv("정격전류(A)", `${fmt(res.ratedI,1)} A`));
    box.appendChild(kv("LS EOCR 기종명", `${res.eocrModel}`));
    box.appendChild(kv("EOCR 세팅값(A)", `${fmt(res.eocrSet,1)} A`));
    box.appendChild(kv("전선(구리)","" + fmt(res.cable,1) + " ㎟"));

    if (res.drop){
      const dropText = Number.isFinite(res.drop.dropV)
        ? `${fmt(res.drop.dropV,1)} V (${fmt(res.drop.dropPct,2)}%) / 허용 ${fmt(res.drop.allowPct,1)}%`
        : `거리 입력 필요 / 허용 ${fmt(res.drop.allowPct,1)}%`;
      box.appendChild(kv("전압강하(표기)", dropText));
    }

    const note = document.createElement("div");
    note.className = "hint";
    note.innerHTML = `EOCR 세팅은 정격전류의 <b>110%</b>, 전선 선정은 <b>정격전류×1.25</b> 기준(간이)입니다.`;
    box.appendChild(note);
  }

  $("calcBtn").addEventListener("click", ()=>{
    render(compute());
  });
</script>
</body>
</html>
